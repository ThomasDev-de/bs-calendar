<!doctype html>
<html lang="en" class="h-100 w-100" data-bs-theme="light">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bootstrap Calendar Demo</title>
    <link href="../vendor/twbs/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="../vendor/twbs/bootstrap-icons/font/bootstrap-icons.min.css" rel="stylesheet">
</head>
<body class="h-100 w-100">
<div class="d-flex justify-content-between align-items-center border-bottom border-5 px-5">
    <h1>$.fn.bsCalendar</h1>
    <div class="form-check form-switch">
        <input class="form-check-input" type="checkbox" role="switch" id="flexSwitchCheckTheme">
        <label class="form-check-label" for="flexSwitchCheckTheme">light / dark</label>
    </div>
</div>

<div id="calendar" class="w-100 p-4" style="height: 800px">
    <div class="d-flex flex-column align-items-stretch h-100 w-100">
        <div class="d-flex align-items-center justify-content-end mb-3 wc-calendar-top-nav">
            <div class="d-flex" role="status">
                <select class="form-select rounded-5" aria-label="Default select example">
                    <option value="day">Tag</option>
                    <option value="week">Woche</option>
                    <option value="month" selected>Monat</option>
                    <option value="year">Jahr</option>
                </select>
            </div>
        </div>
        <div class="d-flex flex-fill wc-calendar-container border">
            <div class="wc-calendar-left-nav  d-flex flex-column w-25">
                <div class="p-3 wc-calendar-month-small">

                </div>
            </div>
            <div class="container-fluid wc-calendar-view-container rounded-5 flex-fill border overflow-hidden  d-flex flex-column align-items-stretch">

            </div>
        </div>
    </div>
</div>
<script src="../vendor/components/jquery/jquery.min.js"></script>

<script src="../vendor/twbs/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
<script src="../dist/bs-calendar.min.js"></script>
<script>
    $(function () {
        $('#calendar').bsCalendar({
            locale: 'de',
            startWeekOnSunday: false,
            rounded: 5,
            translations: {
                day: 'Tag',
                week: 'Woche',
                month: 'Monat',
                year: 'Jahr',
                today: 'Heute',
                appointment: 'Termin',
            },
            url(query) {
                console.log(query);
                const fromDate = new Date(`${query.fromDate}T00:00:00`);
                const toDate = new Date(`${query.toDate}T23:59:59`);

                return generateRandomAppointments(`${query.fromDate}T00:00:00`,`${query.toDate}T23:59:59`, query.view).filter(appointment => {
                    const appointmentStart = new Date(appointment.start);
                    const appointmentEnd = new Date(appointment.end);

                    return (
                        (appointmentStart >= fromDate && appointmentStart < toDate) || // Startzeit liegt im Bereich
                        (appointmentEnd > fromDate && appointmentEnd <= toDate) ||    // Endzeit liegt im Bereich
                        (appointmentStart <= fromDate && appointmentEnd >= toDate)    // Termin umspannt den Bereich
                    );
                });
            }
        }).on('click-appointment.bs.calendar', function (event, appointment) {
            event.preventDefault();
            alert(appointment.title);
        })


        function generateRandomAppointments(start, end, view) {
            const colors = [
                '#007bff',
                '#6c757d',
                '#28a745',
                '#ffc107',
                '#dc3545',
                '#17a2b8',
                '#343a40',
                '#6f42c1',
                '#0dcaf0',
            ];
            const appointments = [];
            const startDate = new Date(start);
            const endDate = new Date(end);
            let count = 0;
            if (view === 'month') {
                count = 50;
            }
            if (view === 'week') {
                count = 10;
            }
            if (view === 'day') {
                count = 25;
            }
            if (view === 'year') {
                count = 200;
            }

            for (let i = 0; i < count; i++) {
                // Zufälliger Startzeitpunkt innerhalb des angegebenen Zeitintervalls
                const randomTimeStart = new Date(
                    startDate.getTime() + Math.random() * (endDate.getTime() - startDate.getTime())
                );

                // Zufällige Dauer (zwischen 30 und 210 Minuten / 30 Min bis 3,5 Stunden)
                const randomDuration = Math.floor(Math.random() * 180) + 30; // Dauer in Minuten
                const randomTimeEnd = new Date(randomTimeStart.getTime() + randomDuration * 60000); // Endzeit berechnen

                // Sicherstellen, dass das Enddatum nicht außerhalb des Bereichs liegt
                if (randomTimeEnd > endDate) {
                    randomTimeEnd.setTime(endDate.getTime());
                }

                // Termin erstellen
                const appointment = {
                    id: i + 1,
                    title: `Termin ${i + 1}`,
                    start: randomTimeStart.toISOString().replace('T', ' ').substring(0, 19),
                    end: randomTimeEnd.toISOString().replace('T', ' ').substring(0, 19),
                    allDay: false,
                    color: colors[Math.floor(Math.random() * colors.length)],
                    link: 'https://www.google.com'
                };

                appointments.push(appointment);
            }

            return appointments;
        }

// Beispielaufruf:
        console.log(generateRandomAppointments(5));

// Beispielaufruf:
        console.log(generateRandomAppointments(5));
        // $('#calendar2').bsCalendar({ rounded:5});

        $('#flexSwitchCheckTheme')
            .on('change', function () {
                const theme = $('html').attr('data-bs-theme') === 'light' ? 'dark' : 'light';
                $('html').attr('data-bs-theme', theme);
            });
    });
</script>
</body>
</html>
