(function($){const DEFAULTS={locale:"en-EN",startWeekOnSunday:true,rounded:5,startDate:new Date,startView:"month",translations:{day:"Day",week:"Week",month:"Month",year:"Year",today:"Today",appointment:"Appointment"}};$.fn.bsCalendar=function(optionsOrMethod,params){if($(this).length>1){return $(this).each(function(i,e){return $(e).bsCalendar(optionsOrMethod,params)})}const optionsGiven=typeof optionsOrMethod==="object";const methodGiven=typeof optionsOrMethod==="string";const wrapper=$(this);if(!wrapper.data("initBsCalendar")){let settings=DEFAULTS;if(optionsGiven){settings=$.extend({},DEFAULTS,wrapper.data(),optionsOrMethod)}setSettings(wrapper,settings);init(wrapper).then(function(){wrapper.data("initBsCalendar",true)})}return wrapper};function init($wrapper){return new Promise((resolve,reject)=>{try{const settings=getSettings($wrapper);$wrapper.data("view",settings.startView);$wrapper.data("date",settings.startDate);buildFramework($wrapper);buildMonthSmallView($wrapper,$(".wc-calendar-month-small"));buildByView($wrapper);handleEvents($wrapper);resolve($wrapper)}catch(error){reject(error)}})}function buildFramework($wrapper){const settings=getSettings($wrapper);$wrapper.empty();const innerWrapper=$("<div>",{class:"d-flex flex-column align-items-stretch h-100 w-100"}).appendTo($wrapper);const topNav=$("<div>",{class:"d-flex align-items-center justify-content-end mb-3 wc-calendar-top-nav"}).appendTo(innerWrapper);const btnNew=$("<button>",{class:`btn rounded-${settings.rounded} border-3 border me-auto`,html:'<i class="bi bi-plus-lg"></i> '+settings.translations.appointment,click:function(){const date=new Date;setDate($wrapper,date);buildByView($wrapper)}}).appendTo(topNav);const navDate=$("<div>",{class:"d-flex mx-2 align-items-center justify-content-center wc-nav-view-wrapper",html:['<small class="wc-nav-view-name me-3">test</small>','<a class="wc-nav-view-prev" href="#"><i class="bi bi-chevron-left"></i></a>','<a class="wc-nav-view-next mx-2" href="#"><i class="bi bi-chevron-right"></i></a>'].join("")}).appendTo(topNav);const todayButton=$("<button>",{class:`btn rounded-${settings.rounded} border-3 mx-2 border`,html:settings.translations.today,click:function(){const date=new Date;setDate($wrapper,date);buildByView($wrapper)}}).appendTo(topNav);const dropDownView=$("<div>",{class:"dropdown wc-select-calendar-view",html:[`<a class="btn rounded-${settings.rounded} border border-3 dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">`,"</a>",'<ul class="dropdown-menu">','<li><a class="dropdown-item" data-view="day" href="#">'+settings.translations.day+"</a></li>",'<li><a class="dropdown-item" data-view="week" href="#">'+settings.translations.week+"</a></li>",'<li><a class="dropdown-item active" data-view="month" href="#">'+settings.translations.month+"</a></li>",'<li><a class="dropdown-item" data-view="year" href="#">'+settings.translations.year+"</a></li>","</ul>"].join("")}).appendTo(topNav);const container=$("<div>",{class:"d-flex flex-fill wc-calendar-container"}).appendTo(innerWrapper);const leftBar=$("<div>",{class:"wc-calendar-left-nav d-xl-flex d-none flex-column me-4",html:['<div class="pb-3">','<div class="d-flex justify-content-between">','<small class="wc-nav-view-small-name me-3">test</small>',"<div>",'<a class="wc-nav-view-prev" href="#"><i class="bi bi-chevron-left"></i></a>','<a class="wc-nav-view-next ms-2" href="#"><i class="bi bi-chevron-right"></i></a>',"</div>","</div>","</div>",'<div class="wc-calendar-month-small"></div>'].join("")}).appendTo(container);const viewContainer=$("<div>",{class:`container-fluid wc-calendar-view-container  border-1 rounded-${settings.rounded} flex-fill border overflow-hidden  d-flex flex-column align-items-stretch`}).appendTo(container)}function setCurrentDateName($wrapper){const settings=getSettings($wrapper);const date=getDate($wrapper);const view=getView($wrapper);const el=$(".wc-nav-view-name");const elSmall=$(".wc-nav-view-small-name");const dayName=date.toLocaleDateString(settings.locale,{day:"numeric"});const weekdayName=date.toLocaleDateString(settings.locale,{weekday:"long"});const monthName=date.toLocaleDateString(settings.locale,{month:"long"});const yearName=date.toLocaleDateString(settings.locale,{year:"numeric"});const calendarWeek=getCalendarWeek(date);switch(view){case"day":el.text(weekdayName+", "+dayName+" "+monthName+" "+yearName);break;case"week":el.text("KW "+calendarWeek+" / "+monthName+" "+yearName);break;case"month":el.text(monthName+" "+yearName);break;case"year":el.text(yearName);break}elSmall.text(monthName+" "+yearName)}function navigateBack($wrapper){const view=getView($wrapper);const date=getDate($wrapper);const newDate=new Date(date);switch(view){case"month":newDate.setMonth(newDate.getMonth()-1);if(newDate.getDate()!==date.getDate()){newDate.setDate(1)}break;case"year":newDate.setFullYear(newDate.getFullYear()-1);newDate.setDate(1);break;case"week":newDate.setDate(newDate.getDate()-7);break;case"day":newDate.setDate(newDate.getDate()-1);break}setDate($wrapper,newDate);buildByView($wrapper)}function navigateForward($wrapper){const view=getView($wrapper);const date=getDate($wrapper);const newDate=new Date(date);switch(view){case"month":newDate.setMonth(newDate.getMonth()+1);if(newDate.getDate()!==date.getDate()){newDate.setDate(1)}break;case"year":newDate.setFullYear(newDate.getFullYear()+1);newDate.setDate(1);break;case"week":newDate.setDate(newDate.getDate()+7);break;case"day":newDate.setDate(newDate.getDate()+1);break}setDate($wrapper,newDate);buildByView($wrapper)}function handleEvents($wrapper){$wrapper.on("click","[data-date]",function(e){e.preventDefault();const date=new Date($(e.currentTarget).attr("data-date"));setView($wrapper,"day");setDate($wrapper,date);buildByView($wrapper)}).on("click","[data-month]",function(e){e.preventDefault();const date=new Date($(e.currentTarget).attr("data-month"));setView($wrapper,"month");setDate($wrapper,date);buildByView($wrapper)}).on("click",".wc-nav-view-prev",function(e){e.preventDefault();navigateBack($wrapper)}).on("click",".wc-nav-view-next",function(e){e.preventDefault();navigateForward($wrapper)}).on("click",".wc-select-calendar-view [data-view]",function(e){e.preventDefault();const dropdown=$(e.currentTarget).closest(".dropdown");dropdown.find(".dropdown-item.active").removeClass("active");const a=$(e.currentTarget);const translate=a.text();dropdown.find(".dropdown-toggle").text(translate);const view=a.data("view");a.addClass("active");setView($wrapper,view);buildByView($wrapper)})}function updateDropdownView($wrapper){const dropdown=$wrapper.find(".wc-select-calendar-view");const view=getView($wrapper);dropdown.find(".dropdown-item.active").removeClass("active");dropdown.find(`[data-view="${view}"]`).addClass("active");dropdown.find(".dropdown-toggle").text(dropdown.find(`[data-view="${view}"]`).text())}function getView($wrapper){return $wrapper.data("view")}function setView($wrapper,view){if(!["day","week","month","year"].includes(view)){view="month"}$wrapper.data("view",view)}function getDate($wrapper){return $wrapper.data("date")}function setDate($wrapper,date){$wrapper.data("date",date)}function getSettings($wrapper){return $wrapper.data("settings")}function setSettings($wrapper,settings){$wrapper.data("settings",settings)}function getViewContainer($wrapper){return $wrapper.find(".wc-calendar-view-container")}function buildByView($wrapper){const view=getView($wrapper);const container=getViewContainer($wrapper).empty();switch(view){case"month":buildMonthView($wrapper);break;case"week":buildWeekView($wrapper);break;case"year":buildYearView($wrapper);break;case"day":buildDayView($wrapper);break;default:break}updateDropdownView($wrapper);setCurrentDateName($wrapper);buildMonthSmallView($wrapper,$(".wc-calendar-month-small"))}function buildDayView($wrapper){const container=getViewContainer($wrapper);$("<h1>",{text:"Day View"}).appendTo(container)}function getShortWeekDayNames(locale,startWeekOnSunday){const formatter=new Intl.DateTimeFormat(locale,{weekday:"short"});const weekDays=[...Array(7).keys()].map(day=>formatter.format(new Date(Date.UTC(2023,0,day+1))));return startWeekOnSunday?weekDays:weekDays.slice(1).concat(weekDays[0])}function buildMonthView($wrapper){const container=getViewContainer($wrapper);const settings=getSettings($wrapper);const date=getDate($wrapper);const{locale,startWeekOnSunday}=settings;const year=date.getFullYear();const month=date.getMonth();const firstDayOfMonth=new Date(year,month,1);const lastDayOfMonth=new Date(year,month+1,0);let calendarStart=new Date(firstDayOfMonth);while(calendarStart.getDay()!==(startWeekOnSunday?0:1)){calendarStart.setDate(calendarStart.getDate()-1)}let calendarEnd=new Date(lastDayOfMonth);while(calendarEnd.getDay()!==(startWeekOnSunday?6:0)){calendarEnd.setDate(calendarEnd.getDate()+1)}container.empty();const weekdaysRow=$("<div>",{class:"row d-flex flex-nowrap wc-calendar-weekdays fw-bold text-bg-secondary"}).append($("<div>",{class:"col d-flex align-items-center justify-content-center",style:"width: 24px",html:"<small></small>"}));const weekDays=getShortWeekDayNames(locale,startWeekOnSunday);weekDays.forEach(day=>{weekdaysRow.append($("<div>",{class:"text-center col flex-fill",html:`<small>${day}</small>`}))});container.append(weekdaysRow);let currentDate=new Date(calendarStart);while(currentDate<=calendarEnd){const weekRow=$("<div>",{class:"row d-flex flex-nowrap flex-fill wc-calendar-content"});const calendarWeek=getCalendarWeek(currentDate);weekRow.append($("<div>",{class:"col d-flex align-items-start py-2 fw-bold text-bg-secondary justify-content-center",style:"width: 24px;",html:`<small>${calendarWeek}</small>`}));for(let i=0;i<7;i++){const isToday=currentDate.toDateString()===(new Date).toDateString();const isOtherMonth=currentDate.getMonth()!==month;const dayClass=isToday?"rounded-circle text-bg-primary":"";const dayWrapper=$("<div>",{class:`col border flex-fill d-flex flex-column align-items-center justify-content-start ${isOtherMonth?"text-muted":""} ${isToday?"":""}`}).appendTo(weekRow);$("<small>",{css:{width:"24px",height:"24px",lineHeight:"24px",fontSize:"12px"},class:`${dayClass} text-center`,text:currentDate.getDate()}).appendTo(dayWrapper);currentDate.setDate(currentDate.getDate()+1)}container.append(weekRow)}}function buildMonthSmallView($wrapper,$container){const settings=getSettings($wrapper);const date=getDate($wrapper);const year=date.getFullYear();const month=date.getMonth();const firstDayOfMonth=new Date(year,month,1);const lastDayOfMonth=new Date(year,month+1,0);let calendarStart=new Date(firstDayOfMonth);while(calendarStart.getDay()!==1){calendarStart.setDate(calendarStart.getDate()-1)}let calendarEnd=new Date(lastDayOfMonth);while(calendarEnd.getDay()!==0){calendarEnd.setDate(calendarEnd.getDate()+1)}$container.empty();$container.addClass("table-responsive");const table=$("<table>",{class:"wc-mini-calendar",css:{fontSize:"10px",borderSpacing:"0",borderCollapse:"collapse",tableLayout:"fixed",textAlign:"center",verticalAlign:"middle",lineHeight:"1.5",padding:"0",margin:"0",backgroundColor:"transparent",border:"0"}}).appendTo($container);const thead=$("<thead>").appendTo(table);const weekdaysRow=$("<tr>",{class:"",css:{height:"24px"}}).appendTo(thead);$("<th>",{class:"",css:{width:"15px"},text:""}).appendTo(weekdaysRow);const weekDays=getShortWeekDayNames(settings.locale,settings.startWeekOnSunday);weekDays.forEach(day=>{$("<th>",{class:"",text:day}).appendTo(weekdaysRow)});const tbody=$("<tbody>").appendTo(table);let currentDate=new Date(calendarStart);while(currentDate<=calendarEnd){const weekRow=$("<tr>",{css:{fontSize:"10px"}}).appendTo(tbody);const calendarWeek=getCalendarWeek(currentDate);$("<td>",{css:{maxWidth:"0px",fontSize:"10px"},class:"text-bg-secondary",text:calendarWeek}).appendTo(weekRow);for(let i=0;i<7;i++){const isToday=currentDate.toDateString()===(new Date).toDateString();const isOtherMonth=currentDate.getMonth()!==month;const dayClass=isToday?"rounded-circle text-bg-primary":"text-decoration-none";const td=$("<td>",{"data-date":formatDate($wrapper,currentDate),css:{cursor:"pointer",fontSize:"10px",width:"24px",height:"24px",lineHeight:"24px",verticalAlign:"middle",textAlign:"center"},html:`<div class="${dayClass} w-100 h-100 d-flex justify-content-center align-items-center">${currentDate.getDate()}</div>`}).appendTo(weekRow);currentDate.setDate(currentDate.getDate()+1)}}}function formatDate($wrapper,date){const settings=getSettings($wrapper);const day=date.toLocaleDateString(settings.locale,{day:"numeric"});const month=date.toLocaleDateString(settings.locale,{month:"numeric"});const year=date.toLocaleDateString(settings.locale,{year:"numeric"});return`${year}-${month}-${day}`}function getCalendarWeek(date){const target=new Date(Date.UTC(date.getFullYear(),date.getMonth(),date.getDate()));const dayNr=(target.getUTCDay()+6)%7;target.setUTCDate(target.getUTCDate()-dayNr+3);const firstThursday=new Date(Date.UTC(target.getUTCFullYear(),0,4));const firstDayOfWeek=firstThursday.getUTCDate()-(firstThursday.getUTCDay()+6)%7;const weekNumber=Math.floor(1+(target-new Date(Date.UTC(target.getUTCFullYear(),0,firstDayOfWeek)))/(7*24*60*60*1e3));return weekNumber}function buildWeekView($wrapper){const container=getViewContainer($wrapper);$("<h1>",{text:"Week View"}).appendTo(container)}function buildYearView($wrapper){const container=getViewContainer($wrapper);const settings=getSettings($wrapper);const date=getDate($wrapper);const year=date.getFullYear();container.empty();const grid=$("<div>",{class:"d-flex flex-wrap",css:{gap:"10px"}}).appendTo(container);for(let month=0;month<12;month++){const monthWrapper=$("<div>",{class:"d-flex shadow p-3 flex-column rounded-"+settings.rounded+" align-items-center wc-year-month-container",css:{width:"200px",margin:"5px"}}).appendTo(grid);const monthName=new Intl.DateTimeFormat(settings.locale,{month:"long"}).format(new Date(year,month));$("<div>",{"data-month":`${year}-${String(month+1).padStart(2,"0")}-01`,class:"text-center fw-bold",text:`${monthName} ${year}`,css:{cursor:"pointer",marginBottom:"10px"}}).appendTo(monthWrapper);const monthContainer=$("<div>").appendTo(monthWrapper);const tempDate=new Date(year,month,1);setDate($wrapper,tempDate);buildMonthSmallView($wrapper,monthContainer)}}})(jQuery);